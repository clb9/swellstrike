<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GENESIS STRIKE - Mission Control</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body, html {
      width: 100%;
      height: 100%;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #0a0e1a;
      color: #fff;
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
    }
    
    #map {
      height: 100vh;
      width: 100%;
      filter: brightness(0.85) contrast(1.1);
    }
    
    /* Command Center HUD */
    .command-hud {
      position: absolute;
      top: 24px;
      left: 24px;
      width: 420px;
      background: rgba(10, 14, 26, 0.75);
      backdrop-filter: blur(20px) saturate(150%);
      -webkit-backdrop-filter: blur(20px) saturate(150%);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.03);
      z-index: 1000;
      animation: hudSlideIn 0.6s cubic-bezier(0.16, 1, 0.3, 1);
    }
    
    @keyframes hudSlideIn {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .hud-header {
      padding: 20px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
    }
    
    .hud-title {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 2px;
      color: #fff;
      text-transform: uppercase;
      margin-bottom: 4px;
      font-family: 'SF Mono', 'Courier New', monospace;
    }
    
    .hud-subtitle {
      font-size: 11px;
      color: rgba(255, 255, 255, 0.4);
      font-weight: 500;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }
    
    .live-indicator {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      background: rgba(34, 197, 94, 0.1);
      border: 1px solid rgba(34, 197, 94, 0.2);
      border-radius: 6px;
      font-size: 10px;
      font-weight: 600;
      letter-spacing: 1px;
      text-transform: uppercase;
      color: #22c55e;
    }
    
    .live-dot {
      width: 6px;
      height: 6px;
      background: #22c55e;
      border-radius: 50%;
      animation: livePulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      box-shadow: 0 0 12px rgba(34, 197, 94, 0.8);
    }
    
    @keyframes livePulse {
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.6; transform: scale(1.2); }
    }
    
    .live-indicator.offline {
      background: rgba(239, 68, 68, 0.1);
      border-color: rgba(239, 68, 68, 0.2);
      color: #ef4444;
    }
    
    .live-indicator.offline .live-dot {
      background: #ef4444;
      animation: none;
      box-shadow: 0 0 12px rgba(239, 68, 68, 0.8);
    }
    
    /* Segmented Control - Futuristic */
    .segment-wrapper {
      padding: 16px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
    }
    
    .segment-control {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      background: rgba(255, 255, 255, 0.02);
      padding: 4px;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.04);
    }
    
    .segment-btn {
      padding: 10px;
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.4);
      font-size: 12px;
      font-weight: 600;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      cursor: pointer;
      border-radius: 7px;
      transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }
    
    .segment-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(139, 92, 246, 0.15));
      opacity: 0;
      transition: opacity 0.25s;
    }
    
    .segment-btn:hover {
      color: rgba(255, 255, 255, 0.7);
    }
    
    .segment-btn.active {
      color: #fff;
      background: rgba(99, 102, 241, 0.15);
      border: 1px solid rgba(99, 102, 241, 0.3);
      box-shadow: 0 4px 16px rgba(99, 102, 241, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }
    
    .segment-btn.active::before {
      opacity: 1;
    }
    
    /* Feature Toggles */
    .toggle-section {
      padding: 16px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
    }
    
    .toggle-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px 0;
    }
    
    .toggle-label {
      font-size: 12px;
      font-weight: 500;
      color: rgba(255, 255, 255, 0.7);
      letter-spacing: 0.3px;
    }
    
    .toggle-switch {
      position: relative;
      width: 44px;
      height: 24px;
      background: rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      cursor: pointer;
      border: 1px solid rgba(255, 255, 255, 0.1);
      transition: all 0.3s;
    }
    
    .toggle-switch::after {
      content: '';
      position: absolute;
      top: 2px;
      left: 2px;
      width: 18px;
      height: 18px;
      background: rgba(255, 255, 255, 0.4);
      border-radius: 50%;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .toggle-switch.active {
      background: rgba(99, 102, 241, 0.3);
      border-color: rgba(99, 102, 241, 0.5);
    }
    
    .toggle-switch.active::after {
      left: 22px;
      background: #6366f1;
      box-shadow: 0 2px 8px rgba(99, 102, 241, 0.5);
    }
    
    /* Stats Grid */
    .stats-grid {
      padding: 16px 24px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }
    
    .stat-card {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 8px;
      padding: 12px;
      text-align: center;
    }
    
    .stat-value {
      font-size: 20px;
      font-weight: 700;
      color: #fff;
      font-family: 'SF Mono', monospace;
    }
    
    .stat-label {
      font-size: 9px;
      color: rgba(255, 255, 255, 0.4);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 4px;
    }
    
    /* Strike Pulse Animation for High-Score Markers */
    @keyframes strikePulse {
      0%, 100% {
        box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7);
      }
      50% {
        box-shadow: 0 0 0 12px rgba(34, 197, 94, 0);
      }
    }
    
    .strike-marker {
      animation: strikePulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }
    
    /* Enhanced Popup Styling */
    .leaflet-popup-content-wrapper {
      background: rgba(10, 14, 26, 0.98);
      backdrop-filter: blur(24px) saturate(150%);
      -webkit-backdrop-filter: blur(24px) saturate(150%);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      box-shadow: 0 16px 48px rgba(0, 0, 0, 0.6);
      padding: 0;
      color: #fff;
      min-width: 320px;
    }
    
    .leaflet-popup-content {
      margin: 0;
      line-height: 1.5;
    }
    
    .leaflet-popup-tip {
      background: rgba(10, 14, 26, 0.98);
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .leaflet-popup-close-button {
      color: rgba(255, 255, 255, 0.5) !important;
      font-size: 20px !important;
      font-weight: 300 !important;
      padding: 12px !important;
      transition: all 0.2s;
    }
    
    .leaflet-popup-close-button:hover {
      color: #fff !important;
    }
    
    /* Popup Tabs */
    .popup-tabs {
      display: flex;
      border-bottom: 1px solid rgba(255, 255, 255, 0.08);
      background: rgba(255, 255, 255, 0.02);
    }
    
    .popup-tab {
      flex: 1;
      padding: 12px;
      text-align: center;
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.5px;
      text-transform: uppercase;
      color: rgba(255, 255, 255, 0.4);
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: all 0.2s;
    }
    
    .popup-tab:hover {
      color: rgba(255, 255, 255, 0.7);
      background: rgba(255, 255, 255, 0.03);
    }
    
    .popup-tab.active {
      color: #6366f1;
      border-bottom-color: #6366f1;
      background: rgba(99, 102, 241, 0.05);
    }
    
    .popup-content {
      padding: 20px;
    }
    
    .popup-header {
      margin-bottom: 16px;
    }
    
    .popup-title {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 4px;
    }
    
    .confidence-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.5px;
      text-transform: uppercase;
    }
    
    .confidence-strike {
      background: rgba(34, 197, 94, 0.15);
      color: #22c55e;
      border: 1px solid rgba(34, 197, 94, 0.3);
    }
    
    .confidence-good {
      background: rgba(234, 179, 8, 0.15);
      color: #eab308;
      border: 1px solid rgba(234, 179, 8, 0.3);
    }
    
    .confidence-poor {
      background: rgba(239, 68, 68, 0.15);
      color: #ef4444;
      border: 1px solid rgba(239, 68, 68, 0.3);
    }
    
    .data-grid {
      display: grid;
      gap: 12px;
      margin: 16px 0;
    }
    
    .data-row {
      display: flex;
      justify-content: space-between;
      padding: 10px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    .data-row:last-child {
      border-bottom: none;
    }
    
    .data-label {
      font-size: 12px;
      color: rgba(255, 255, 255, 0.5);
      font-weight: 500;
    }
    
    .data-value {
      font-size: 13px;
      color: #fff;
      font-weight: 600;
      font-family: 'SF Mono', monospace;
    }
    
    .action-buttons {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-top: 16px;
    }
    
    .action-btn {
      padding: 10px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 8px;
      color: rgba(255, 255, 255, 0.8);
      font-size: 11px;
      font-weight: 600;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }
    
    .action-btn:hover {
      background: rgba(99, 102, 241, 0.15);
      border-color: rgba(99, 102, 241, 0.3);
      color: #fff;
      transform: translateY(-1px);
    }
    
    .action-btn-primary {
      background: rgba(99, 102, 241, 0.2);
      border-color: rgba(99, 102, 241, 0.4);
      color: #fff;
    }
    
    .action-btn-primary:hover {
      background: rgba(99, 102, 241, 0.3);
      box-shadow: 0 4px 16px rgba(99, 102, 241, 0.3);
    }
    
    .video-container {
      margin: 16px 0;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.08);
    }
    
    .missed-strike-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(239, 68, 68, 0.15);
      border: 2px solid rgba(239, 68, 68, 0.5);
      border-radius: 50%;
      pointer-events: none;
      animation: missedPulse 3s ease-in-out infinite;
    }
    
    @keyframes missedPulse {
      0%, 100% { opacity: 0.3; transform: scale(1); }
      50% { opacity: 0.8; transform: scale(1.1); }
    }
    
    @keyframes fireRotate {
      0% { transform: rotate(0deg) scale(1); }
      25% { transform: rotate(-10deg) scale(1.1); }
      50% { transform: rotate(0deg) scale(1); }
      75% { transform: rotate(10deg) scale(1.1); }
      100% { transform: rotate(0deg) scale(1); }
    }
    
    /* Strike Board Panel */
    .strike-board {
      position: absolute;
      top: 24px;
      right: 24px;
      width: 360px;
      max-height: calc(100vh - 48px);
      background: rgba(10, 14, 26, 0.75);
      backdrop-filter: blur(20px) saturate(150%);
      -webkit-backdrop-filter: blur(20px) saturate(150%);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      z-index: 1000;
      animation: slideInRight 0.6s cubic-bezier(0.16, 1, 0.3, 1);
      display: flex;
      flex-direction: column;
    }
    
    @keyframes slideInRight {
      from {
        opacity: 0;
        transform: translateX(30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
    
    .strike-board.hidden {
      display: none;
    }
    
    .strike-board-header {
      padding: 20px 24px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.04);
    }
    
    .strike-board-title {
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 2px;
      color: #22c55e;
      text-transform: uppercase;
      font-family: 'SF Mono', monospace;
      margin-bottom: 4px;
    }
    
    .strike-board-subtitle {
      font-size: 10px;
      color: rgba(255, 255, 255, 0.4);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .strike-board-content {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
    }
    
    .strike-board-content::-webkit-scrollbar {
      width: 6px;
    }
    
    .strike-board-content::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.02);
    }
    
    .strike-board-content::-webkit-scrollbar-thumb {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 3px;
    }
    
    .strike-item {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.06);
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 12px;
      cursor: pointer;
      transition: all 0.2s;
      position: relative;
      overflow: hidden;
    }
    
    .strike-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 4px;
      height: 100%;
      background: linear-gradient(180deg, #22c55e, #16a34a);
      opacity: 0;
      transition: opacity 0.2s;
    }
    
    .strike-item:hover {
      background: rgba(255, 255, 255, 0.05);
      border-color: rgba(99, 102, 241, 0.3);
      transform: translateX(-2px);
    }
    
    .strike-item:hover::before {
      opacity: 1;
    }
    
    .strike-item-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px;
    }
    
    .strike-item-name {
      font-size: 14px;
      font-weight: 600;
      color: #fff;
      margin-bottom: 2px;
    }
    
    .strike-item-region {
      font-size: 10px;
      color: rgba(255, 255, 255, 0.4);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .strike-item-score {
      font-size: 20px;
      font-weight: 700;
      color: #22c55e;
      font-family: 'SF Mono', monospace;
    }
    
    .strike-item-details {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      font-size: 11px;
    }
    
    .strike-detail {
      text-align: center;
      padding: 6px;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 6px;
    }
    
    .strike-detail-value {
      font-weight: 600;
      color: #fff;
      font-family: 'SF Mono', monospace;
      display: block;
      margin-bottom: 2px;
    }
    
    .strike-detail-label {
      font-size: 9px;
      color: rgba(255, 255, 255, 0.4);
      text-transform: uppercase;
    }
  </style>
</head>
<body>
  <div id="map"></div>
  
  <!-- Command HUD -->
  <div class="command-hud">
    <!-- Header -->
    <div class="hud-header">
      <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px;">
        <div>
          <h1 class="hud-title">GENESIS STRIKE</h1>
          <p class="hud-subtitle">Global Mission Control</p>
        </div>
        <div class="live-indicator" id="liveIndicator">
          <div class="live-dot"></div>
          <span>LIVE</span>
        </div>
      </div>
      <!-- Fire Alert -->
      <div id="fire-alert" style="display: none; margin-top: 12px;"></div>
    </div>
    
    <!-- Segment Control -->
    <div class="segment-wrapper">
      <div class="segment-control">
        <button class="segment-btn active" id="seg-all">All Zones</button>
        <button class="segment-btn" id="seg-surf">Surf</button>
        <button class="segment-btn" id="seg-ski">Ski</button>
      </div>
    </div>
    
    <!-- Feature Toggles -->
    <div class="toggle-section">
      <div class="toggle-item">
        <span class="toggle-label">Missed Strikes (24-48h)</span>
        <div class="toggle-switch" id="toggle-missed"></div>
      </div>
      <div class="toggle-item">
        <span class="toggle-label">High Confidence Only (>80)</span>
        <div class="toggle-switch" id="toggle-highconf"></div>
      </div>
      <div class="toggle-item">
        <span class="toggle-label">Strike Board</span>
        <div class="toggle-switch active" id="toggle-board"></div>
      </div>
    </div>
    
    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="stat-active">0</div>
        <div class="stat-label">Active Strikes</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-zones">233</div>
        <div class="stat-label">Total Zones</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="stat-missed">0</div>
        <div class="stat-label">Missed (48h)</div>
      </div>
    </div>
  </div>
  
  <!-- Strike Board Panel -->
  <div id="strike-board" class="strike-board">
    <div class="strike-board-header">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
        <h2 class="strike-board-title">STRIKE BOARD</h2>
        <div style="display: flex; gap: 6px;">
          <button class="board-filter-btn active" id="board-all" onclick="filterStrikeBoard('all')" 
                  style="padding: 4px 10px; background: rgba(99, 102, 241, 0.2); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 6px; color: #6366f1; font-size: 9px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; cursor: pointer;">
            All
          </button>
          <button class="board-filter-btn" id="board-surf" onclick="filterStrikeBoard('surf')"
                  style="padding: 4px 10px; background: transparent; border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: rgba(255,255,255,0.5); font-size: 9px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; cursor: pointer;">
            Surf
          </button>
          <button class="board-filter-btn" id="board-ski" onclick="filterStrikeBoard('ski')"
                  style="padding: 4px 10px; background: transparent; border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: rgba(255,255,255,0.5); font-size: 9px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; cursor: pointer;">
            Ski
          </button>
        </div>
      </div>
      <div class="strike-board-subtitle">Epic conditions detected</div>
    </div>
    <div class="strike-board-content" id="strike-board-content">
      <div style="text-align: center; padding: 40px 20px; color: rgba(255,255,255,0.3);">
        <div style="font-size: 32px; margin-bottom: 12px;">üéØ</div>
        <div style="font-size: 12px;">Scanning for strikes...</div>
      </div>
    </div>
  </div>

  <script>
    console.log('üöÄ GENESIS STRIKE - Initializing...');
    
    // API KEYS (User should replace these)
    const OPENWEATHER_KEY = 'YOUR_OPENWEATHER_API_KEY'; // Get from openweathermap.org
    const OPEN_METEO_BASE = 'https://marine-api.open-meteo.com/v1/marine';
    
    // GLOBAL SURF BREAKS (Coordinates-based for 100% coverage)
    const SURF_BREAKS = {
      // California
      'sb-rincon': { name: 'Rincon', lat: 34.3733, lon: -119.4785, region: 'CA', type: 'point' },
      'sb-malibu': { name: 'Malibu', lat: 34.0359, lon: -118.6795, region: 'CA', type: 'point' },
      'sb-trestles': { name: 'Trestles', lat: 33.3876, lon: -117.5903, region: 'CA', type: 'beach' },
      'sb-blacks': { name: 'Blacks Beach', lat: 32.8897, lon: -117.2513, region: 'CA', type: 'beach' },
      'sb-steamer': { name: 'Steamer Lane', lat: 36.9513, lon: -122.0271, region: 'CA', type: 'point' },
      'sb-mavericks': { name: 'Mavericks', lat: 37.4943, lon: -122.4967, region: 'CA', type: 'big_wave' },
      
      // Hawaii
      'hi-pipeline': { name: 'Pipeline', lat: 21.6641, lon: -158.0522, region: 'HI', type: 'reef' },
      'hi-sunset': { name: 'Sunset Beach', lat: 21.6769, lon: -158.0419, region: 'HI', type: 'beach' },
      'hi-waimea': { name: 'Waimea Bay', lat: 21.6434, lon: -158.0645, region: 'HI', type: 'big_wave' },
      
      // Mexico
      'mx-cabo': { name: 'Cabo San Lucas', lat: 22.8905, lon: -109.9167, region: 'Mexico', type: 'beach' },
      'mx-puerto': { name: 'Puerto Escondido', lat: 15.8571, lon: -97.0661, region: 'Mexico', type: 'beach' },
      'mx-sayulita': { name: 'Sayulita', lat: 20.8700, lon: -105.4400, region: 'Mexico', type: 'beach' },
      
      // El Salvador
      'sv-sunzal': { name: 'El Sunzal', lat: 13.5080, lon: -89.5300, region: 'El Salvador', type: 'point' },
      'sv-tunco': { name: 'El Tunco', lat: 13.4930, lon: -89.4080, region: 'El Salvador', type: 'beach' },
      
      // Nicaragua
      'nic-popoyo': { name: 'Popoyo', lat: 11.4530, lon: -86.4610, region: 'Nicaragua', type: 'reef' },
      'nic-maderas': { name: 'Playa Maderas', lat: 11.4200, lon: -86.0100, region: 'Nicaragua', type: 'beach' },
      
      // Costa Rica
      'cr-tamarindo': { name: 'Tamarindo', lat: 10.2980, lon: -85.8380, region: 'Costa Rica', type: 'beach' },
      'cr-jaco': { name: 'Jaco', lat: 9.6140, lon: -84.6290, region: 'Costa Rica', type: 'beach' },
      'cr-pavones': { name: 'Pavones', lat: 8.2580, lon: -83.1360, region: 'Costa Rica', type: 'point' },
      'cr-salsa': { name: 'Salsa Brava', lat: 9.6510, lon: -82.7550, region: 'Costa Rica', type: 'reef' },
      'cr-witches': { name: 'Witches Rock', lat: 10.8400, lon: -85.8700, region: 'Costa Rica', type: 'reef' },
      
      // Panama
      'pan-bocas': { name: 'Bocas del Toro', lat: 9.3400, lon: -82.2480, region: 'Panama', type: 'beach' },
      'pan-santa': { name: 'Santa Catalina', lat: 7.6330, lon: -81.2610, region: 'Panama', type: 'beach' },
      
      // Northeast US
      'ne-montauk': { name: 'Montauk', lat: 41.0370, lon: -71.9200, region: 'NY', type: 'beach' },
      'ne-ruggles': { name: 'Ruggles', lat: 41.4720, lon: -71.2700, region: 'RI', type: 'beach' },
      'ne-nantucket': { name: 'Nantucket', lat: 41.2835, lon: -70.0995, region: 'MA', type: 'beach' },
      
      // CHILE - Pacific Coast
      'cl-arica': { name: 'Arica - El Gringo', lat: -18.4783, lon: -70.3126, region: 'Chile', type: 'reef' },
      'cl-iquique': { name: 'Iquique - Playa Brava', lat: -20.2307, lon: -70.1355, region: 'Chile', type: 'beach' },
      'cl-antofagasta': { name: 'Antofagasta - La Portada', lat: -23.4472, lon: -70.6208, region: 'Chile', type: 'point' },
      'cl-pichilemu': { name: 'Pichilemu - Punta de Lobos', lat: -34.3903, lon: -72.0275, region: 'Chile', type: 'point' },
      'cl-infernillo': { name: 'Pichilemu - Infernillo', lat: -34.3814, lon: -72.0231, region: 'Chile', type: 'beach' },
      'cl-la-puntilla': { name: 'Pichilemu - La Puntilla', lat: -34.3875, lon: -72.0255, region: 'Chile', type: 'point' },
      'cl-matanzas': { name: 'Matanzas', lat: -34.0344, lon: -71.8647, region: 'Chile', type: 'beach' },
      'cl-cobquecura': { name: 'Cobquecura', lat: -36.1308, lon: -72.7889, region: 'Chile', type: 'beach' },
      'cl-buchupureo': { name: 'Buchupureo', lat: -36.0669, lon: -72.7669, region: 'Chile', type: 'beach' },
      'cl-pichicuy': { name: 'Pichicuy', lat: -32.3089, lon: -71.4831, region: 'Chile', type: 'beach' },
      'cl-ritoque': { name: 'Ritoque', lat: -32.9211, lon: -71.5419, region: 'Chile', type: 'beach' },
      'cl-concon': { name: 'Conc√≥n', lat: -32.9253, lon: -71.5231, region: 'Chile', type: 'beach' },
      
      // PERU - North Coast (Epic)
      'pe-chicama': { name: 'Chicama', lat: -7.8447, lon: -79.4469, region: 'Peru', type: 'point' },
      'pe-pacasmayo': { name: 'Pacasmayo', lat: -7.4006, lon: -79.5711, region: 'Peru', type: 'point' },
      'pe-malabrigo': { name: 'Malabrigo', lat: -7.7144, lon: -79.4517, region: 'Peru', type: 'point' },
      'pe-lobitos': { name: 'Lobitos', lat: -4.4606, lon: -81.2781, region: 'Peru', type: 'point' },
      'pe-mancora': { name: 'M√°ncora', lat: -4.1039, lon: -81.0472, region: 'Peru', type: 'beach' },
      'pe-cabo-blanco': { name: 'Cabo Blanco', lat: -4.2392, lon: -81.1131, region: 'Peru', type: 'point' },
      
      // PERU - Lima Area
      'pe-pico-alto': { name: 'Pico Alto', lat: -12.1808, lon: -77.0064, region: 'Peru', type: 'reef' },
      'pe-herradura': { name: 'Herradura', lat: -12.1653, lon: -77.0153, region: 'Peru', type: 'beach' },
      'pe-punta-rocas': { name: 'Punta Rocas', lat: -12.3183, lon: -76.8289, region: 'Peru', type: 'point' },
      'pe-kon-tiki': { name: 'Kon Tiki', lat: -12.1461, lon: -77.0239, region: 'Peru', type: 'beach' },
      
      // BRAZIL - Northeast (Best Surf)
      'br-fernando': { name: 'Fernando de Noronha', lat: -3.8542, lon: -32.4231, region: 'Brazil', type: 'reef' },
      'br-cacimba': { name: 'Cacimba do Padre', lat: -3.8389, lon: -32.4381, region: 'Brazil', type: 'beach' },
      'br-itacare': { name: 'Itacar√©', lat: -14.2778, lon: -38.9969, region: 'Brazil', type: 'beach' },
      'br-jericoacoara': { name: 'Jericoacoara', lat: -2.7928, lon: -40.5156, region: 'Brazil', type: 'beach' },
      'br-saquarema': { name: 'Saquarema', lat: -22.9308, lon: -42.5128, region: 'Brazil', type: 'beach' },
      
      // BRAZIL - South (Consistent)
      'br-floripa': { name: 'Florian√≥polis - Joaquina', lat: -27.6292, lon: -48.4472, region: 'Brazil', type: 'beach' },
      'br-praia-mole': { name: 'Praia Mole', lat: -27.6111, lon: -48.4375, region: 'Brazil', type: 'beach' },
      'br-garopaba': { name: 'Garopaba', lat: -28.0236, lon: -48.6169, region: 'Brazil', type: 'beach' },
      'br-guarda': { name: 'Guarda do Emba√∫', lat: -27.9069, lon: -48.6253, region: 'Brazil', type: 'beach' },
      'br-imbituba': { name: 'Imbituba', lat: -28.2297, lon: -48.6661, region: 'Brazil', type: 'beach' },
    };
    
    // GLOBAL SKI RESORTS - Complete Ikon, Epic, and Indy Pass Coverage
    const SKI_RESORTS = [
      // IKON PASS - Western US
      { id: 'alta', name: 'Alta', lat: 40.588, lon: -111.638, region: 'UT', pass: 'Ikon', elevation: 2616 },
      { id: 'snowbird', name: 'Snowbird', lat: 40.583, lon: -111.657, region: 'UT', pass: 'Ikon', elevation: 3353 },
      { id: 'deer-valley', name: 'Deer Valley', lat: 40.637, lon: -111.478, region: 'UT', pass: 'Ikon', elevation: 2917 },
      { id: 'solitude', name: 'Solitude', lat: 40.619, lon: -111.592, region: 'UT', pass: 'Ikon', elevation: 3076 },
      { id: 'brighton', name: 'Brighton', lat: 40.598, lon: -111.583, region: 'UT', pass: 'Ikon', elevation: 3048 },
      { id: 'jackson', name: 'Jackson Hole', lat: 43.588, lon: -110.828, region: 'WY', pass: 'Ikon', elevation: 3185 },
      { id: 'big-sky', name: 'Big Sky', lat: 45.261, lon: -111.308, region: 'MT', pass: 'Ikon', elevation: 3403 },
      { id: 'aspen', name: 'Aspen Mountain', lat: 39.191, lon: -106.818, region: 'CO', pass: 'Ikon', elevation: 3417 },
      { id: 'aspen-highlands', name: 'Aspen Highlands', lat: 39.182, lon: -106.855, region: 'CO', pass: 'Ikon', elevation: 3596 },
      { id: 'snowmass', name: 'Snowmass', lat: 39.213, lon: -106.948, region: 'CO', pass: 'Ikon', elevation: 3813 },
      { id: 'steamboat', name: 'Steamboat', lat: 40.457, lon: -106.805, region: 'CO', pass: 'Ikon', elevation: 3221 },
      { id: 'winter-park', name: 'Winter Park', lat: 39.887, lon: -105.762, region: 'CO', pass: 'Ikon', elevation: 3676 },
      { id: 'copper', name: 'Copper Mountain', lat: 39.502, lon: -106.150, region: 'CO', pass: 'Ikon', elevation: 3776 },
      { id: 'eldora', name: 'Eldora', lat: 39.937, lon: -105.582, region: 'CO', pass: 'Ikon', elevation: 3274 },
      { id: 'mammoth', name: 'Mammoth Mountain', lat: 37.631, lon: -119.033, region: 'CA', pass: 'Ikon', elevation: 3369 },
      { id: 'palisades', name: 'Palisades Tahoe', lat: 39.197, lon: -120.235, region: 'CA', pass: 'Ikon', elevation: 2760 },
      { id: 'june', name: 'June Mountain', lat: 37.764, lon: -119.078, region: 'CA', pass: 'Ikon', elevation: 3090 },
      { id: 'crystal', name: 'Crystal Mountain', lat: 46.936, lon: -121.474, region: 'WA', pass: 'Ikon', elevation: 2134 },
      { id: 'stevens', name: 'Stevens Pass', lat: 47.745, lon: -121.089, region: 'WA', pass: 'Ikon', elevation: 1790 },
      { id: 'mission', name: 'Mission Ridge', lat: 47.291, lon: -120.399, region: 'WA', pass: 'Ikon', elevation: 2067 },
      { id: 'tremblant', name: 'Tremblant', lat: 46.210, lon: -74.596, region: 'QC', pass: 'Ikon', elevation: 875 },
      { id: 'blue-mountain', name: 'Blue Mountain', lat: 44.508, lon: -80.317, region: 'ON', pass: 'Ikon', elevation: 720 },
      
      // IKON PASS - Northeast
      { id: 'killington', name: 'Killington', lat: 43.604, lon: -72.820, region: 'VT', pass: 'Ikon', elevation: 1293 },
      { id: 'pico', name: 'Pico Mountain', lat: 43.658, lon: -72.846, region: 'VT', pass: 'Ikon', elevation: 1201 },
      { id: 'stratton', name: 'Stratton', lat: 43.114, lon: -72.908, region: 'VT', pass: 'Ikon', elevation: 1179 },
      { id: 'sugarbush', name: 'Sugarbush', lat: 44.134, lon: -72.902, region: 'VT', pass: 'Ikon', elevation: 1230 },
      { id: 'sugarloaf', name: 'Sugarloaf', lat: 45.031, lon: -70.313, region: 'ME', pass: 'Ikon', elevation: 1291 },
      { id: 'sunday-river', name: 'Sunday River', lat: 44.473, lon: -70.857, region: 'ME', pass: 'Ikon', elevation: 1036 },
      { id: 'loon', name: 'Loon Mountain', lat: 44.036, lon: -71.621, region: 'NH', pass: 'Ikon', elevation: 932 },
      
      // IKON PASS - Canada West
      { id: 'revelstoke', name: 'Revelstoke', lat: 50.946, lon: -118.156, region: 'BC', pass: 'Ikon', elevation: 2225 },
      { id: 'cypress', name: 'Cypress Mountain', lat: 49.397, lon: -123.206, region: 'BC', pass: 'Ikon', elevation: 1440 },
      { id: 'snowshoe', name: 'Snowshoe', lat: 38.410, lon: -79.994, region: 'WV', pass: 'Ikon', elevation: 1478 },
      
      // EPIC PASS - Western US
      { id: 'vail', name: 'Vail', lat: 39.640, lon: -106.374, region: 'CO', pass: 'Epic', elevation: 3527 },
      { id: 'beaver-creek', name: 'Beaver Creek', lat: 39.604, lon: -106.516, region: 'CO', pass: 'Epic', elevation: 3488 },
      { id: 'breckenridge', name: 'Breckenridge', lat: 39.480, lon: -106.067, region: 'CO', pass: 'Epic', elevation: 3962 },
      { id: 'keystone', name: 'Keystone', lat: 39.579, lon: -105.935, region: 'CO', pass: 'Epic', elevation: 3782 },
      { id: 'crested-butte', name: 'Crested Butte', lat: 38.900, lon: -106.966, region: 'CO', pass: 'Epic', elevation: 3707 },
      { id: 'heavenly', name: 'Heavenly', lat: 38.935, lon: -119.940, region: 'CA/NV', pass: 'Epic', elevation: 3068 },
      { id: 'northstar', name: 'Northstar', lat: 39.272, lon: -120.121, region: 'CA', pass: 'Epic', elevation: 2624 },
      { id: 'kirkwood', name: 'Kirkwood', lat: 38.688, lon: -120.066, region: 'CA', pass: 'Epic', elevation: 2987 },
      { id: 'park-city', name: 'Park City', lat: 40.651, lon: -111.508, region: 'UT', pass: 'Epic', elevation: 3048 },
      { id: 'stevens-epic', name: 'Stevens Pass', lat: 47.745, lon: -121.089, region: 'WA', pass: 'Epic', elevation: 1790 },
      { id: 'whistler', name: 'Whistler Blackcomb', lat: 50.116, lon: -122.949, region: 'BC', pass: 'Epic', elevation: 2182 },
      
      // EPIC PASS - Midwest
      { id: 'afton', name: 'Afton Alps', lat: 44.857, lon: -92.777, region: 'MN', pass: 'Epic', elevation: 335 },
      { id: 'wilmot', name: 'Wilmot Mountain', lat: 42.517, lon: -88.179, region: 'WI', pass: 'Epic', elevation: 335 },
      { id: 'mad-river', name: 'Mad River Mountain', lat: 40.300, lon: -83.451, region: 'OH', pass: 'Epic', elevation: 440 },
      { id: 'paoli', name: 'Paoli Peaks', lat: 38.402, lon: -86.446, region: 'IN', pass: 'Epic', elevation: 295 },
      { id: 'hidden-valley', name: 'Hidden Valley', lat: 39.953, lon: -79.545, region: 'PA', pass: 'Epic', elevation: 777 },
      
      // EPIC PASS - Northeast
      { id: 'mount-snow', name: 'Mount Snow', lat: 42.960, lon: -72.920, region: 'VT', pass: 'Epic', elevation: 1128 },
      { id: 'okemo', name: 'Okemo', lat: 43.402, lon: -72.720, region: 'VT', pass: 'Epic', elevation: 1076 },
      { id: 'stowe', name: 'Stowe', lat: 44.531, lon: -72.787, region: 'VT', pass: 'Epic', elevation: 1216 },
      { id: 'hunter', name: 'Hunter Mountain', lat: 42.200, lon: -74.224, region: 'NY', pass: 'Epic', elevation: 1036 },
      { id: 'attitash', name: 'Attitash', lat: 44.078, lon: -71.253, region: 'NH', pass: 'Epic', elevation: 876 },
      { id: 'wildcat', name: 'Wildcat', lat: 44.264, lon: -71.232, region: 'NH', pass: 'Epic', elevation: 1237 },
      { id: 'crotched', name: 'Crotched Mountain', lat: 42.997, lon: -71.877, region: 'NH', pass: 'Epic', elevation: 610 },
      { id: 'mount-sunapee', name: 'Mount Sunapee', lat: 43.336, lon: -72.078, region: 'NH', pass: 'Epic', elevation: 805 },
      { id: 'liberty', name: 'Liberty', lat: 39.756, lon: -77.380, region: 'PA', pass: 'Epic', elevation: 625 },
      { id: 'roundtop', name: 'Roundtop', lat: 40.134, lon: -76.932, region: 'PA', pass: 'Epic', elevation: 550 },
      { id: 'whitetail', name: 'Whitetail', lat: 39.735, lon: -77.941, region: 'PA', pass: 'Epic', elevation: 594 },
      { id: 'jack-frost', name: 'Jack Frost', lat: 41.113, lon: -75.647, region: 'PA', pass: 'Epic', elevation: 610 },
      
      // INDY PASS - Western US
      { id: 'bridger', name: 'Bridger Bowl', lat: 45.816, lon: -110.900, region: 'MT', pass: 'Indy', elevation: 2600 },
      { id: 'lookout', name: 'Lookout Pass', lat: 47.465, lon: -115.725, region: 'ID/MT', pass: 'Indy', elevation: 1676 },
      { id: 'lost-trail', name: 'Lost Trail', lat: 45.692, lon: -113.927, region: 'MT', pass: 'Indy', elevation: 2600 },
      { id: 'showdown', name: 'Showdown', lat: 47.086, lon: -110.626, region: 'MT', pass: 'Indy', elevation: 2515 },
      { id: 'discovery', name: 'Discovery', lat: 46.384, lon: -113.176, region: 'MT', pass: 'Indy', elevation: 2438 },
      { id: 'magic', name: 'Magic Mountain', lat: 43.122, lon: -72.839, region: 'VT', pass: 'Indy', elevation: 503 },
      { id: 'bolton', name: 'Bolton Valley', lat: 44.399, lon: -72.862, region: 'VT', pass: 'Indy', elevation: 1030 },
      { id: 'berkshire-east', name: 'Berkshire East', lat: 42.573, lon: -72.758, region: 'MA', pass: 'Indy', elevation: 579 },
      { id: 'cannon', name: 'Cannon Mountain', lat: 44.157, lon: -71.699, region: 'NH', pass: 'Indy', elevation: 1267 },
      { id: 'black-mountain', name: 'Black Mountain', lat: 43.932, lon: -71.355, region: 'NH', pass: 'Indy', elevation: 549 },
      { id: 'saddleback', name: 'Saddleback', lat: 44.937, lon: -70.495, region: 'ME', pass: 'Indy', elevation: 1219 },
      { id: 'baker', name: 'Mt. Baker', lat: 48.859, lon: -121.686, region: 'WA', pass: 'Indy', elevation: 1565 },
      { id: 'white-pass', name: 'White Pass', lat: 46.638, lon: -121.390, region: 'WA', pass: 'Indy', elevation: 1829 },
      { id: 'mt-ashland', name: 'Mt. Ashland', lat: 42.077, lon: -122.696, region: 'OR', pass: 'Indy', elevation: 2296 },
      { id: 'hoodoo', name: 'Hoodoo', lat: 44.399, lon: -121.867, region: 'OR', pass: 'Indy', elevation: 1707 },
      { id: 'willamette', name: 'Willamette Pass', lat: 43.618, lon: -122.033, region: 'OR', pass: 'Indy', elevation: 2062 },
      { id: 'anthony-lakes', name: 'Anthony Lakes', lat: 44.954, lon: -118.234, region: 'OR', pass: 'Indy', elevation: 2438 },
      { id: 'china-peak', name: 'China Peak', lat: 37.301, lon: -119.154, region: 'CA', pass: 'Indy', elevation: 2576 },
      { id: 'dodge-ridge', name: 'Dodge Ridge', lat: 38.191, lon: -120.072, region: 'CA', pass: 'Indy', elevation: 2530 },
      { id: 'homewood', name: 'Homewood', lat: 39.081, lon: -120.163, region: 'CA', pass: 'Indy', elevation: 2347 },
      { id: 'mt-shasta', name: 'Mt. Shasta', lat: 41.368, lon: -122.184, region: 'CA', pass: 'Indy', elevation: 2012 },
      { id: 'yosemite', name: 'Yosemite Ski & Snowboard', lat: 37.668, lon: -119.664, region: 'CA', pass: 'Indy', elevation: 2438 },
      { id: 'eagle-point', name: 'Eagle Point', lat: 40.454, lon: -111.365, region: 'UT', pass: 'Indy', elevation: 2804 },
      { id: 'powder-mountain', name: 'Powder Mountain', lat: 41.379, lon: -111.781, region: 'UT', pass: 'Indy', elevation: 2713 },
      { id: 'cherry-peak', name: 'Cherry Peak', lat: 41.614, lon: -111.610, region: 'UT', pass: 'Indy', elevation: 2195 },
      { id: 'brianhead', name: 'Brian Head', lat: 37.699, lon: -112.849, region: 'UT', pass: 'Indy', elevation: 3353 },
      { id: 'pomerelle', name: 'Pomerelle', lat: 42.274, lon: -113.669, region: 'ID', pass: 'Indy', elevation: 2438 },
      { id: 'soldier', name: 'Soldier Mountain', lat: 43.414, lon: -114.831, region: 'ID', pass: 'Indy', elevation: 2286 },
      { id: 'taos', name: 'Taos Ski Valley', lat: 36.593, lon: -105.445, region: 'NM', pass: 'Indy', elevation: 3804 },
      { id: 'pajarito', name: 'Pajarito', lat: 35.886, lon: -106.312, region: 'NM', pass: 'Indy', elevation: 3231 },
      { id: 'sipapu', name: 'Sipapu', lat: 36.174, lon: -105.638, region: 'NM', pass: 'Indy', elevation: 2743 },
      { id: 'ski-apache', name: 'Ski Apache', lat: 33.360, lon: -105.752, region: 'NM', pass: 'Indy', elevation: 3505 },
      { id: 'sandia', name: 'Sandia Peak', lat: 35.213, lon: -106.408, region: 'NM', pass: 'Indy', elevation: 3163 },
      { id: 'monarch', name: 'Monarch Mountain', lat: 38.512, lon: -106.332, region: 'CO', pass: 'Indy', elevation: 3658 },
      { id: 'powderhorn', name: 'Powderhorn', lat: 39.067, lon: -108.152, region: 'CO', pass: 'Indy', elevation: 2743 },
      { id: 'hesperus', name: 'Hesperus', lat: 37.289, lon: -108.058, region: 'CO', pass: 'Indy', elevation: 2896 },
      { id: 'sunlight', name: 'Sunlight', lat: 39.419, lon: -107.369, region: 'CO', pass: 'Indy', elevation: 2743 },
      { id: 'purgatory', name: 'Purgatory', lat: 37.628, lon: -107.814, region: 'CO', pass: 'Indy', elevation: 3176 },
      { id: 'lee-canyon', name: 'Lee Canyon', lat: 36.307, lon: -115.687, region: 'NV', pass: 'Indy', elevation: 2804 },
      { id: 'arizona', name: 'Arizona Snowbowl', lat: 35.330, lon: -111.710, region: 'AZ', pass: 'Indy', elevation: 3505 },
      { id: 'sunrise', name: 'Sunrise Park', lat: 33.949, lon: -109.780, region: 'AZ', pass: 'Indy', elevation: 3354 },
      
      // ADDITIONAL REQUESTED
      { id: 'jay-peak', name: 'Jay Peak', lat: 44.938, lon: -72.503, region: 'VT', pass: 'Ikon', elevation: 1189 },
      { id: 'waterville', name: 'Waterville Valley', lat: 43.960, lon: -71.516, region: 'NH', pass: 'Independent', elevation: 1219 },
      
      // SOUTH AMERICA - Major Resorts
      { id: 'valle-nevado', name: 'Valle Nevado', lat: -33.350, lon: -70.250, region: 'Chile', pass: 'Ikon', elevation: 3670 },
      { id: 'portillo', name: 'Portillo', lat: -32.835, lon: -70.137, region: 'Chile', pass: 'Independent', elevation: 3310 },
      { id: 'las-lenas', name: 'Las Le√±as', lat: -35.148, lon: -70.078, region: 'Argentina', pass: 'Independent', elevation: 3430 },
      { id: 'cerro-catedral', name: 'Cerro Catedral', lat: -41.163, lon: -71.408, region: 'Argentina', pass: 'Independent', elevation: 2388 },
      { id: 'chapelco', name: 'Chapelco', lat: -40.164, lon: -71.295, region: 'Argentina', pass: 'Independent', elevation: 1980 },
      { id: 'cerro-bayo', name: 'Cerro Bayo', lat: -40.816, lon: -71.399, region: 'Argentina', pass: 'Independent', elevation: 1782 },
      { id: 'el-colorado', name: 'El Colorado', lat: -33.349, lon: -70.313, region: 'Chile', pass: 'Independent', elevation: 3333 },
      { id: 'la-parva', name: 'La Parva', lat: -33.347, lon: -70.280, region: 'Chile', pass: 'Independent', elevation: 3630 },
    ];
    
    let map = null;
    let surfMarkers = [];
    let skiMarkers = [];
    let currentView = 'all';
    let showMissedStrikes = false;
    let showHighConfOnly = false;
    let showStrikeBoard = true;
    let strikeBoardFilter = 'all'; // 'all', 'surf', 'ski'
    let strikeData = {};
    let missedStrikes = [];
    
    // UPDATE STRIKE BOARD
    function updateStrikeBoard() {
      if (!showStrikeBoard) return;
      
      const boardContent = document.getElementById('strike-board-content');
      if (!boardContent) return;
      
      // Get all strikes (score >= 70), filtered by type
      const strikes = Object.entries(strikeData)
        .filter(([id, data]) => {
          if (data.score < 70) return false;
          if (strikeBoardFilter === 'surf' && data.type !== 'surf') return false;
          if (strikeBoardFilter === 'ski' && data.type !== 'ski') return false;
          return true;
        })
        .sort((a, b) => b[1].score - a[1].score);
      
      if (strikes.length === 0) {
        const emptyType = strikeBoardFilter === 'all' ? '' : strikeBoardFilter === 'surf' ? 'surf ' : 'ski ';
        boardContent.innerHTML = `
          <div style="text-align: center; padding: 40px 20px; color: rgba(255,255,255,0.3);">
            <div style="font-size: 32px; margin-bottom: 12px;">üåä</div>
            <div style="font-size: 12px;">No active ${emptyType}strikes</div>
            <div style="font-size: 11px; margin-top: 8px; color: rgba(255,255,255,0.2);">Check back later</div>
          </div>
        `;
        return;
      }
      
      let html = '';
      strikes.forEach(([id, data]) => {
        const spot = data.type === 'surf' ? SURF_BREAKS[id] : SKI_RESORTS.find(r => r.id === id);
        if (!spot) return;
        
        // Add pass badge for ski resorts
        let passBadge = '';
        if (data.type === 'ski' && spot.pass) {
          const passColors = {
            'Ikon': 'rgba(99, 102, 241, 0.2)',
            'Epic': 'rgba(239, 68, 68, 0.2)',
            'Indy': 'rgba(34, 197, 94, 0.2)'
          };
          passBadge = `<div style="display: inline-block; padding: 2px 6px; background: ${passColors[spot.pass] || 'rgba(255,255,255,0.1)'}; border-radius: 4px; font-size: 8px; margin-left: 6px; text-transform: uppercase; letter-spacing: 0.5px;">${spot.pass}</div>`;
        }
        
        let details = '';
        if (data.type === 'surf') {
          const heightFt = ((data.waveHeight || 0) * 3.28084).toFixed(1);
          const windMph = ((data.windSpeed || 0) * 2.237).toFixed(0);
          details = `
            <div class="strike-detail">
              <span class="strike-detail-value">${heightFt}ft</span>
              <span class="strike-detail-label">Height</span>
            </div>
            <div class="strike-detail">
              <span class="strike-detail-value">${data.wavePeriod || 0}s</span>
              <span class="strike-detail-label">Period</span>
            </div>
            <div class="strike-detail">
              <span class="strike-detail-value">${windMph}mph</span>
              <span class="strike-detail-label">Wind</span>
            </div>
          `;
        } else {
          const past48 = data.historical ? (data.historical.snow48h / 2.54).toFixed(1) : '0.0';
          const future48 = data.snowTotals ? (data.snowTotals.snow48h / 2.54).toFixed(1) : '0.0';
          const tempF = data.current ? ((data.current.temp * 9/5) + 32).toFixed(0) : '--';
          details = `
            <div class="strike-detail">
              <span class="strike-detail-value">${past48}"</span>
              <span class="strike-detail-label">Past 48h</span>
            </div>
            <div class="strike-detail">
              <span class="strike-detail-value">${future48}"</span>
              <span class="strike-detail-label">Next 48h</span>
            </div>
            <div class="strike-detail">
              <span class="strike-detail-value">${tempF}¬∞F</span>
              <span class="strike-detail-label">Temp</span>
            </div>
          `;
        }
        
        html += `
          <div class="strike-item" onclick="flyToStrike('${id}', ${spot.lat}, ${spot.lon})">
            <div class="strike-item-header">
              <div>
                <div class="strike-item-name">${spot.name}${passBadge}</div>
                <div class="strike-item-region">${spot.region} ¬∑ ${data.type === 'surf' ? 'Surf' : 'Ski'}</div>
              </div>
              <div class="strike-item-score">${data.score}</div>
            </div>
            <div class="strike-item-details">
              ${details}
            </div>
          </div>
        `;
      });
      
      boardContent.innerHTML = html;
    }
    
    // FILTER STRIKE BOARD
    window.filterStrikeBoard = function(type) {
      strikeBoardFilter = type;
      
      // Update button styles
      document.querySelectorAll('.board-filter-btn').forEach(btn => {
        if (btn.id === `board-${type}`) {
          btn.style.background = 'rgba(99, 102, 241, 0.2)';
          btn.style.borderColor = 'rgba(99, 102, 241, 0.3)';
          btn.style.color = '#6366f1';
          btn.classList.add('active');
        } else {
          btn.style.background = 'transparent';
          btn.style.borderColor = 'rgba(255,255,255,0.1)';
          btn.style.color = 'rgba(255,255,255,0.5)';
          btn.classList.remove('active');
        }
      });
      
      updateStrikeBoard();
    };
    
    // FLY TO STRIKE ON MAP
    window.flyToStrike = function(id, lat, lon) {
      map.flyTo([lat, lon], 8, {
        duration: 1.5
      });
      
      // Find and open the popup
      setTimeout(() => {
        const markerObj = surfMarkers.find(m => m.id === id) || skiMarkers.find(m => m.id === id);
        if (markerObj && markerObj.marker) {
          markerObj.marker.openPopup();
        }
      }, 1600);
    };
    
    // INITIALIZE MAP
    function initMap() {
      console.log('Initializing map...');
      
      map = L.map('map', {
        zoomControl: false,
        attributionControl: false
      }).setView([20, -100], 3);
      
      L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        subdomains: 'abcd',
        maxZoom: 19
      }).addTo(map);
      
      // Add zoom control to bottom right
      L.control.zoom({ position: 'bottomright' }).addTo(map);
      
      console.log('Map initialized');
      addAllMarkers();
      
      // Fetch data after markers are placed
      setTimeout(() => {
        fetchAllData();
      }, 1000);
    }
    
    // ADD ALL MARKERS
    function addAllMarkers() {
      console.log('Adding markers...');
      
      // Add surf markers
      Object.keys(SURF_BREAKS).forEach(breakId => {
        const spot = SURF_BREAKS[breakId];
        const marker = L.circleMarker([spot.lat, spot.lon], {
          radius: 7,
          fillColor: '#6366f1',
          color: '#fff',
          weight: 1.5,
          opacity: 0.9,
          fillOpacity: 0.6
        }).addTo(map);
        
        marker.bindPopup(createPopupContent(spot, breakId, 'surf'));
        surfMarkers.push({ id: breakId, marker, spot });
      });
      
      // Add ski markers
      SKI_RESORTS.forEach(resort => {
        const marker = L.marker([resort.lat, resort.lon], {
          icon: L.divIcon({
            className: '',
            html: `<div style="font-size: 20px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5));">‚õ∑</div>`,
            iconSize: [24, 24]
          })
        }).addTo(map);
        
        marker.bindPopup(createPopupContent(resort, resort.id, 'ski'));
        skiMarkers.push({ id: resort.id, marker, resort });
      });
      
      updateStats();
      console.log(`Added ${surfMarkers.length} surf + ${skiMarkers.length} ski markers`);
    }
    
    // CREATE POPUP CONTENT (will fetch data immediately when opened)
    function createPopupContent(spot, id, type) {
      const popupId = `popup-${id}`;
      
      // Fetch data immediately
      setTimeout(() => {
        if (type === 'surf') {
          fetchAndDisplaySurfData(id, popupId);
        } else {
          fetchAndDisplaySkiData(id, popupId);
        }
      }, 100);
      
      return `
        <div id="${popupId}">
          <div class="popup-tabs">
            <div class="popup-tab active" onclick="switchTab('${popupId}', 'conditions')">Conditions</div>
            <div class="popup-tab" onclick="switchTab('${popupId}', 'intel')">Intel</div>
            <div class="popup-tab" onclick="switchTab('${popupId}', 'travel')">Travel</div>
          </div>
          <div class="popup-content">
            <div class="tab-content" data-tab="conditions">
              <div class="popup-header">
                <h3 class="popup-title">${spot.name}</h3>
                <span class="confidence-badge confidence-poor" id="${popupId}-badge">Loading...</span>
              </div>
              <div id="${popupId}-forecast">
                <div style="text-align: center; padding: 40px 0; color: rgba(255,255,255,0.4);">
                  <div style="font-size: 24px; margin-bottom: 8px;">‚è≥</div>
                  <div style="font-size: 12px;">Loading forecast...</div>
                </div>
              </div>
            </div>
            <div class="tab-content" data-tab="intel" style="display: none;">
              <div class="popup-header">
                <h3 class="popup-title">Spot Intelligence</h3>
              </div>
              ${getYouTubeEmbedHTML(spot.name, type)}
              <div class="action-buttons" style="margin-top: 16px;">
                ${type === 'surf' 
                  ? `<a href="${getSurflineURL(spot.name)}" target="_blank" class="action-btn">üìä Surfline Guide</a>`
                  : `<a href="${getOnTheSnowURL(spot.name)}" target="_blank" class="action-btn">‚õ∑Ô∏è OnTheSnow</a>`
                }
                ${type === 'ski' 
                  ? `<a href="${getResortOfficialURL(id)}" target="_blank" class="action-btn">üèîÔ∏è Lifts & Terrain</a>`
                  : `<a href="#" class="action-btn">üìπ Live Cam</a>`
                }
              </div>
            </div>
            <div class="tab-content" data-tab="travel" style="display: none;">
              <div class="popup-header">
                <h3 class="popup-title">Travel Intel</h3>
              </div>
              <div class="data-grid">
                <div class="data-row">
                  <span class="data-label">Flights from SFO</span>
                  <span class="data-value">$${estimateFlightCost(spot.region)}</span>
                </div>
                <div class="data-row">
                  <span class="data-label">Visa Required</span>
                  <span class="data-value">${getVisaInfo(spot.region)}</span>
                </div>
              </div>
              <div class="action-buttons" style="grid-template-columns: 1fr;">
                <a href="https://www.google.com/flights?q=${encodeURIComponent(spot.name)}" target="_blank" class="action-btn action-btn-primary">
                  ‚úàÔ∏è Book Flights
                </a>
              </div>
            </div>
          </div>
        </div>
      `;
    }
    
    // FETCH AND DISPLAY SURF DATA IN POPUP
    async function fetchAndDisplaySurfData(breakId, popupId) {
      const spot = SURF_BREAKS[breakId];
      
      try {
        const url = `${OPEN_METEO_BASE}?latitude=${spot.lat}&longitude=${spot.lon}&hourly=wave_height,wave_period,wind_wave_height,wind_speed_10m,wind_direction_10m&forecast_days=3&timezone=auto`;
        
        const response = await fetch(url);
        const data = await response.json();
        
        if (!data.hourly) throw new Error('No data');
        
        // Get current + next 72 hours
        const now = new Date();
        const currentIndex = data.hourly.time.findIndex(t => new Date(t) >= now);
        
        // Current conditions
        const current = {
          waveHeight: data.hourly.wave_height[currentIndex],
          wavePeriod: data.hourly.wave_period[currentIndex],
          windSpeed: data.hourly.wind_speed_10m[currentIndex],
          windDir: data.hourly.wind_direction_10m[currentIndex]
        };
        
        // 3-day forecast (every 6 hours)
        const forecast = [];
        for (let i = 0; i < 3; i++) {
          const dayIndex = currentIndex + (i * 24);
          if (dayIndex < data.hourly.time.length) {
            const dayData = {
              day: new Date(data.hourly.time[dayIndex]).toLocaleDateString('en-US', { weekday: 'short' }),
              waveHeight: data.hourly.wave_height[dayIndex],
              wavePeriod: data.hourly.wave_period[dayIndex],
              windSpeed: data.hourly.wind_speed_10m[dayIndex]
            };
            forecast.push(dayData);
          }
        }
        
        // Calculate score
        const next48h = [];
        for (let i = currentIndex; i < currentIndex + 48 && i < data.hourly.time.length; i++) {
          next48h.push({
            waveHeight: data.hourly.wave_height[i],
            wavePeriod: data.hourly.wave_period[i],
            windSpeed: data.hourly.wind_speed_10m[i]
          });
        }
        
        const score = calculateSurfStrikeConfidence({ ...current, next48h });
        
        // Update badge
        const badge = document.getElementById(`${popupId}-badge`);
        if (badge) {
          const confidenceClass = score >= 80 ? 'confidence-strike' : score >= 60 ? 'confidence-good' : 'confidence-poor';
          const confidenceLabel = score >= 80 ? 'üéØ STRIKE' : score >= 60 ? 'GOOD' : 'POOR';
          badge.className = `confidence-badge ${confidenceClass}`;
          badge.textContent = `${score}/100 ${confidenceLabel}`;
        }
        
        // Update forecast display
        const forecastDiv = document.getElementById(`${popupId}-forecast`);
        if (forecastDiv) {
          forecastDiv.innerHTML = createForecastHTML(current, forecast, 'surf');
        }
        
        // Store in global data
        strikeData[breakId] = {
          type: 'surf',
          score,
          ...current,
          forecast,
          timestamp: new Date()
        };
        
        // Update marker
        updateSurfMarker(breakId, score, current);
        updateStrikeBoard();
        
      } catch (err) {
        console.error('Surf data fetch failed:', err);
        const forecastDiv = document.getElementById(`${popupId}-forecast`);
        if (forecastDiv) {
          forecastDiv.innerHTML = '<div style="text-align: center; padding: 20px; color: #ef4444;">Failed to load forecast</div>';
        }
      }
    }
    
    // FETCH AND DISPLAY SKI DATA IN POPUP
    async function fetchAndDisplaySkiData(resortId, popupId) {
      const resort = SKI_RESORTS.find(r => r.id === resortId);
      
      try {
        // Fetch Historical (Past 48h), Current, and Forecast (Next 96h+) in parallel
        const [historical, forecast, current] = await Promise.all([
          fetchHistoricalSnow(resort.lat, resort.lon),
          fetchForecastSnow(resort.lat, resort.lon),
          fetchCurrentWeather(resort.lat, resort.lon)
        ]);
        
        // Calculate snow totals for multiple time windows
        const snowTotals = calculateSnowTotals(forecast);
        
        // Calculate Precision Strike Score
        const score = getSkiStrikeScore(historical, snowTotals, current);
        
        // Build 96h forecast timeline for sparkline
        const timeline = buildSnowTimeline(forecast);
        
        // Update badge
        const badge = document.getElementById(`${popupId}-badge`);
        if (badge) {
          const confidenceClass = score >= 85 ? 'confidence-strike' : score >= 70 ? 'confidence-good' : 'confidence-poor';
          const confidenceLabel = score >= 85 ? 'üî• FIRING' : score >= 70 ? 'üéØ STRIKE' : score >= 60 ? 'GOOD' : 'POOR';
          badge.className = `confidence-badge ${confidenceClass}`;
          badge.textContent = `${score}/100 ${confidenceLabel}`;
        }
        
        // Update forecast display with enhanced ski data
        const forecastDiv = document.getElementById(`${popupId}-forecast`);
        if (forecastDiv) {
          forecastDiv.innerHTML = createSkiForecastHTML(historical, current, forecast, snowTotals, timeline);
        }
        
        // Store in global data
        strikeData[resortId] = {
          type: 'ski',
          score,
          historical,
          current,
          forecast,
          snowTotals,
          timeline,
          timestamp: new Date()
        };
        
        // Update marker and Strike Board
        updateSkiMarker(resortId, score, { 
          temp: current.temp, 
          windSpeed: current.windSpeed, 
          snow24h: historical.snow48h 
        });
        updateStrikeBoard();
        checkFireAlert();
        
      } catch (err) {
        console.error('Ski data fetch failed:', err);
        const forecastDiv = document.getElementById(`${popupId}-forecast`);
        if (forecastDiv) {
          forecastDiv.innerHTML = '<div style="text-align: center; padding: 20px; color: #ef4444;">Failed to load forecast</div>';
        }
      }
    }
    
    // FETCH HISTORICAL SNOW (Past 48h) - Open-Meteo Archive API
    async function fetchHistoricalSnow(lat, lon) {
      const endDate = new Date();
      const startDate = new Date(endDate.getTime() - 48 * 60 * 60 * 1000); // 48h ago
      
      const formatDate = (date) => date.toISOString().split('T')[0];
      
      const url = `https://archive-api.open-meteo.com/v1/archive?latitude=${lat}&longitude=${lon}&start_date=${formatDate(startDate)}&end_date=${formatDate(endDate)}&daily=snowfall_sum&timezone=auto`;
      
      const response = await fetch(url);
      const data = await response.json();
      
      // Sum snowfall from past 48h
      const snow48h = data.daily.snowfall_sum.reduce((sum, val) => sum + (val || 0), 0);
      
      return {
        snow48h, // cm
        raw: data
      };
    }
    
    // FETCH FORECAST SNOW (Next 96h+) - Open-Meteo Forecast API
    async function fetchForecastSnow(lat, lon) {
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=snowfall,temperature_2m,windspeed_10m&forecast_days=5&timezone=auto`;
      
      const response = await fetch(url);
      const data = await response.json();
      
      return {
        hourlySnow: data.hourly.snowfall, // All hours (120 hours = 5 days)
        hourlyTemp: data.hourly.temperature_2m,
        hourlyWind: data.hourly.windspeed_10m,
        times: data.hourly.time,
        raw: data
      };
    }
    
    // CALCULATE SNOW TOTALS (24/48/72/96 hours)
    function calculateSnowTotals(forecast) {
      // Sum snowfall for different time windows
      const totals = {
        snow24h: 0,
        snow48h: 0,
        snow72h: 0,
        snow96h: 0
      };
      
      // Calculate cumulative totals
      for (let i = 0; i < forecast.hourlySnow.length && i < 96; i++) {
        const snowfall = forecast.hourlySnow[i] || 0;
        
        if (i < 24) totals.snow24h += snowfall;
        if (i < 48) totals.snow48h += snowfall;
        if (i < 72) totals.snow72h += snowfall;
        if (i < 96) totals.snow96h += snowfall;
      }
      
      return totals;
    }
    
    // FETCH CURRENT WEATHER
    async function fetchCurrentWeather(lat, lon) {
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&timezone=auto`;
      
      const response = await fetch(url);
      const data = await response.json();
      
      return {
        temp: data.current_weather.temperature, // Celsius
        windSpeed: data.current_weather.windspeed, // km/h
        raw: data
      };
    }
    
    // GET SKI STRIKE SCORE (Precision Algorithm)
    function getSkiStrikeScore(historical, snowTotals, current) {
      let score = 0;
      
      // Past 48h Snow (40 points max)
      // 1cm = 2.5 pts, cap at 15cm
      const past48cm = Math.min(historical.snow48h, 15);
      score += past48cm * 2.5;
      
      // Forecast 48h Snow (40 points max)
      // 1cm = 2 pts, cap at 20cm
      const future48cm = Math.min(snowTotals.snow48h, 20);
      score += future48cm * 2;
      
      // Temperature Quality (20 points)
      const tempC = current.temp;
      if (tempC < -5) {
        score += 20; // Dry powder
      } else if (tempC < 0) {
        score += 10; // Decent
      } else if (tempC > 0) {
        score -= 30; // Slush penalty
      }
      
      // Bonus: Consistent snowfall over 48h
      if (historical.snow48h > 10 && snowTotals.snow48h > 10) {
        score += 10; // Multi-day storm bonus
      }
      
      return Math.max(0, Math.min(100, Math.round(score)));
    }
    
    // BUILD SNOW TIMELINE (for sparkline visualization)
    function buildSnowTimeline(forecast) {
      const timeline = [];
      
      // Group hourly data into 6-hour blocks for next 96 hours
      for (let i = 0; i < 96 && i < forecast.hourlySnow.length; i += 6) {
        const block = forecast.hourlySnow.slice(i, i + 6);
        const blockSum = block.reduce((sum, val) => sum + (val || 0), 0);
        const blockTime = new Date(forecast.times[i]);
        
        timeline.push({
          time: blockTime.toLocaleString('en-US', { 
            month: 'short', 
            day: 'numeric', 
            hour: 'numeric' 
          }),
          snow: blockSum,
          temp: forecast.hourlyTemp[i]
        });
      }
      
      return timeline;
    }
    
    // CREATE SKI FORECAST HTML (Enhanced with historical + forecast totals + sparkline)
    function createSkiForecastHTML(historical, current, forecast, snowTotals, timeline) {
      const tempF = (current.temp * 9/5 + 32).toFixed(0);
      const windMph = (current.windSpeed * 0.621371).toFixed(0);
      const past48hInches = (historical.snow48h / 2.54).toFixed(1);
      
      // Determine powder quality
      let qualityLabel = 'Unknown';
      let qualityColor = '#6366f1';
      if (current.temp < -5) {
        qualityLabel = 'Dry Powder';
        qualityColor = '#22c55e';
      } else if (current.temp < 0) {
        qualityLabel = 'Good Snow';
        qualityColor = '#eab308';
      } else if (current.temp > 0) {
        qualityLabel = 'Wet/Slush';
        qualityColor = '#ef4444';
      }
      
      // Current Conditions
      const currentHTML = `
        <div style="margin-bottom: 20px;">
          <div style="font-size: 10px; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;">Current Conditions</div>
          <div class="data-grid">
            <div class="data-row">
              <span class="data-label">Temperature</span>
              <span class="data-value">${tempF}¬∞F</span>
            </div>
            <div class="data-row">
              <span class="data-label">Wind</span>
              <span class="data-value">${windMph}mph</span>
            </div>
            <div class="data-row">
              <span class="data-label">Snow Quality</span>
              <span class="data-value" style="color: ${qualityColor};">${qualityLabel}</span>
            </div>
          </div>
        </div>
      `;
      
      // Historical
      const historicalHTML = `
        <div style="margin-bottom: 20px;">
          <div style="font-size: 10px; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;">Historical (Observed)</div>
          <div style="background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 8px; padding: 16px; text-align: center;">
            <div style="font-size: 32px; font-weight: 700; color: #6366f1; font-family: 'SF Mono', monospace; margin-bottom: 4px;">${past48hInches}"</div>
            <div style="font-size: 10px; color: rgba(255,255,255,0.5); text-transform: uppercase; letter-spacing: 0.5px;">Past 48h (Actual)</div>
          </div>
        </div>
      `;
      
      // Forecast Totals (24/48/72/96 hours)
      const snow24 = (snowTotals.snow24h / 2.54).toFixed(1);
      const snow48 = (snowTotals.snow48h / 2.54).toFixed(1);
      const snow72 = (snowTotals.snow72h / 2.54).toFixed(1);
      const snow96 = (snowTotals.snow96h / 2.54).toFixed(1);
      
      const forecastTotalsHTML = `
        <div style="margin-bottom: 20px;">
          <div style="font-size: 10px; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;">Snow Forecast Totals</div>
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px;">
            <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 8px; padding: 12px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #22c55e; font-family: 'SF Mono', monospace;">${snow24}"</div>
              <div style="font-size: 9px; color: rgba(255,255,255,0.5); text-transform: uppercase; margin-top: 2px;">Next 24h</div>
            </div>
            <div style="background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.2); border-radius: 8px; padding: 12px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #22c55e; font-family: 'SF Mono', monospace;">${snow48}"</div>
              <div style="font-size: 9px; color: rgba(255,255,255,0.5); text-transform: uppercase; margin-top: 2px;">Next 48h</div>
            </div>
            <div style="background: rgba(34, 197, 94, 0.08); border: 1px solid rgba(34, 197, 94, 0.15); border-radius: 8px; padding: 12px; text-align: center;">
              <div style="font-size: 20px; font-weight: 700; color: #22c55e; font-family: 'SF Mono', monospace;">${snow72}"</div>
              <div style="font-size: 9px; color: rgba(255,255,255,0.5); text-transform: uppercase; margin-top: 2px;">Next 72h</div>
            </div>
            <div style="background: rgba(34, 197, 94, 0.08); border: 1px solid rgba(34, 197, 94, 0.15); border-radius: 8px; padding: 12px; text-align: center;">
              <div style="font-size: 20px; font-weight: 700; color: #22c55e; font-family: 'SF Mono', monospace;">${snow96}"</div>
              <div style="font-size: 9px; color: rgba(255,255,255,0.5); text-transform: uppercase; margin-top: 2px;">Next 96h</div>
            </div>
          </div>
        </div>
      `;
      
      // Snow Run Sparkline (when is snow falling)
      const maxSnow = Math.max(...timeline.map(t => t.snow), 1);
      let sparklineHTML = '<div style="font-size: 10px; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;">Snow Timeline (96h)</div>';
      
      timeline.forEach(block => {
        const barHeight = (block.snow / maxSnow) * 100;
        const barColor = block.snow > 2 ? '#22c55e' : block.snow > 0.5 ? '#eab308' : '#374151';
        
        sparklineHTML += `
          <div style="margin-bottom: 10px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 4px;">
              <span style="font-size: 10px; color: rgba(255,255,255,0.6);">${block.time}</span>
              <span style="font-size: 10px; color: rgba(255,255,255,0.5); font-family: 'SF Mono', monospace;">${block.snow.toFixed(1)}cm</span>
            </div>
            <div style="height: 4px; background: rgba(255,255,255,0.05); border-radius: 2px; overflow: hidden;">
              <div style="height: 100%; width: ${barHeight}%; background: ${barColor}; border-radius: 2px; transition: width 0.5s ease;"></div>
            </div>
          </div>
        `;
      });
      
      return currentHTML + historicalHTML + forecastTotalsHTML + sparklineHTML;
    }
    
    // CREATE FORECAST HTML
    function createForecastHTML(current, forecast, type) {
      let currentHTML = '';
      
      if (type === 'surf') {
        const heightFt = (current.waveHeight * 3.28084).toFixed(1);
        const windMph = (current.windSpeed * 2.237).toFixed(0);
        currentHTML = `
          <div style="margin-bottom: 20px;">
            <div style="font-size: 10px; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;">Current Conditions</div>
            <div class="data-grid">
              <div class="data-row">
                <span class="data-label">Wave Height</span>
                <span class="data-value">${heightFt}ft</span>
              </div>
              <div class="data-row">
                <span class="data-label">Period</span>
                <span class="data-value">${current.wavePeriod}s</span>
              </div>
              <div class="data-row">
                <span class="data-label">Wind</span>
                <span class="data-value">${windMph}mph</span>
              </div>
            </div>
          </div>
        `;
      } else {
        const tempF = (current.temp * 9/5 + 32).toFixed(0);
        currentHTML = `
          <div style="margin-bottom: 20px;">
            <div style="font-size: 10px; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;">Current Conditions</div>
            <div class="data-grid">
              <div class="data-row">
                <span class="data-label">Temperature</span>
                <span class="data-value">${tempF}¬∞F</span>
              </div>
              <div class="data-row">
                <span class="data-label">24h Snow</span>
                <span class="data-value">${current.snow24h.toFixed(1)}cm</span>
              </div>
              <div class="data-row">
                <span class="data-label">Wind</span>
                <span class="data-value">${current.windSpeed.toFixed(0)}mph</span>
              </div>
            </div>
          </div>
        `;
      }
      
      // 3-day forecast bars
      let forecastHTML = '<div style="font-size: 10px; color: rgba(255,255,255,0.4); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 12px;">3-Day Forecast</div>';
      
      forecast.forEach(day => {
        let barValue, barLabel, barColor;
        
        if (type === 'surf') {
          const heightFt = (day.waveHeight * 3.28084).toFixed(1);
          barValue = Math.min(100, (day.waveHeight / 4) * 100); // Scale to 4m max
          barLabel = `${heightFt}ft ¬∑ ${day.wavePeriod}s`;
          barColor = day.waveHeight >= 1.5 ? '#22c55e' : day.waveHeight >= 1.0 ? '#eab308' : '#6366f1';
        } else {
          const tempF = (day.temp * 9/5 + 32).toFixed(0);
          barValue = Math.min(100, (day.snow / 30) * 100); // Scale to 30cm max
          barLabel = `${day.snow.toFixed(0)}cm ¬∑ ${tempF}¬∞F`;
          barColor = day.snow >= 10 ? '#22c55e' : day.snow >= 5 ? '#eab308' : '#6366f1';
        }
        
        forecastHTML += `
          <div style="margin-bottom: 16px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
              <span style="font-size: 11px; font-weight: 600; color: rgba(255,255,255,0.7);">${day.day}</span>
              <span style="font-size: 11px; color: rgba(255,255,255,0.5); font-family: 'SF Mono', monospace;">${barLabel}</span>
            </div>
            <div style="height: 6px; background: rgba(255,255,255,0.05); border-radius: 3px; overflow: hidden;">
              <div style="height: 100%; width: ${barValue}%; background: ${barColor}; border-radius: 3px; transition: width 0.5s ease;"></div>
            </div>
          </div>
        `;
      });
      
      return currentHTML + forecastHTML;
    }
    
    // SWITCH POPUP TABS
    window.switchTab = function(popupId, tabName) {
      const popup = document.getElementById(popupId);
      if (!popup) return;
      
      popup.querySelectorAll('.popup-tab').forEach(tab => tab.classList.remove('active'));
      popup.querySelectorAll('.tab-content').forEach(content => content.style.display = 'none');
      
      popup.querySelector(`.popup-tab[onclick*="${tabName}"]`).classList.add('active');
      popup.querySelector(`[data-tab="${tabName}"]`).style.display = 'block';
    };
    
    // FETCH ALL DATA
    async function fetchAllData() {
      console.log('üåä Fetching global data...');
      setLiveStatus(true);
      
      // Fetch surf data
      for (const breakId of Object.keys(SURF_BREAKS).slice(0, 10)) { // Limit to 10 for demo
        try {
          await fetchSurfData(breakId);
          await new Promise(resolve => setTimeout(resolve, 500)); // Rate limit
        } catch (err) {
          console.error(`Failed to fetch ${breakId}:`, err);
        }
      }
      
      // Fetch ski data
      for (const resort of SKI_RESORTS.slice(0, 5)) { // Limit to 5 for demo
        try {
          await fetchSkiData(resort.id);
          await new Promise(resolve => setTimeout(resolve, 1000)); // Rate limit
        } catch (err) {
          console.error(`Failed to fetch ${resort.id}:`, err);
        }
      }
      
      updateStats();
      console.log('‚úÖ Data fetch complete');
    }
    
    // FETCH SURF DATA (Open-Meteo Marine API)
    async function fetchSurfData(breakId) {
      const spot = SURF_BREAKS[breakId];
      
      const url = `${OPEN_METEO_BASE}?latitude=${spot.lat}&longitude=${spot.lon}&hourly=wave_height,wave_period,wind_wave_height,wind_speed_10m,wind_direction_10m&forecast_days=3`;
      
      const response = await fetch(url);
      const data = await response.json();
      
      if (!data.hourly) {
        console.log(`No data for ${spot.name}`);
        return;
      }
      
      // Get current hour data
      const now = new Date();
      const currentIndex = data.hourly.time.findIndex(t => new Date(t) >= now);
      
      const waveHeight = data.hourly.wave_height[currentIndex];
      const wavePeriod = data.hourly.wave_period[currentIndex];
      const windSpeed = data.hourly.wind_speed_10m[currentIndex];
      const windDir = data.hourly.wind_direction_10m[currentIndex];
      
      // Calculate next 48h forecast for "Swell Run" bonus
      const next48h = [];
      for (let i = currentIndex; i < currentIndex + 48 && i < data.hourly.time.length; i++) {
        next48h.push({
          waveHeight: data.hourly.wave_height[i],
          wavePeriod: data.hourly.wave_period[i],
          windSpeed: data.hourly.wind_speed_10m[i]
        });
      }
      
      const score = calculateSurfStrikeConfidence({
        waveHeight,
        wavePeriod,
        windSpeed,
        windDir,
        next48h
      });
      
      strikeData[breakId] = {
        type: 'surf',
        score,
        waveHeight,
        wavePeriod,
        windSpeed,
        windDir,
        timestamp: new Date()
      };
      
      updateSurfMarker(breakId, score, { waveHeight, wavePeriod, windSpeed, windDir });
    }
    
    // FETCH SKI DATA (OpenWeatherMap)
    async function fetchSkiData(resortId) {
      const resort = SKI_RESORTS.find(r => r.id === resortId);
      
      if (OPENWEATHER_KEY === 'YOUR_OPENWEATHER_API_KEY') {
        console.log('‚ö†Ô∏è OpenWeather API key not configured');
        return;
      }
      
      const url = `https://api.openweathermap.org/data/2.5/weather?lat=${resort.lat}&lon=${resort.lon}&appid=${OPENWEATHER_KEY}&units=metric`;
      
      const response = await fetch(url);
      const data = await response.json();
      
      const temp = data.main.temp;
      const windSpeed = data.wind.speed * 2.237; // Convert to mph
      const snow24h = data.snow ? (data.snow['1h'] || 0) * 24 / 10 : 0; // Rough 24h estimate in cm
      
      const score = calculateSkiStrikeConfidence({
        snow24h,
        temp,
        windSpeed
      });
      
      strikeData[resortId] = {
        type: 'ski',
        score,
        temp,
        windSpeed,
        snow24h,
        timestamp: new Date()
      };
      
      updateSkiMarker(resortId, score, { temp, windSpeed, snow24h });
    }
    
    // CALCULATE SURF STRIKE CONFIDENCE (Genesis Algorithm)
    function calculateSurfStrikeConfidence({ waveHeight, wavePeriod, windSpeed, windDir, next48h }) {
      let score = 0;
      
      // Wave Height (40% weight) - optimal 1.5-3m
      const heightMeters = waveHeight || 0;
      if (heightMeters >= 1.5 && heightMeters <= 3.0) {
        score += 40;
      } else if (heightMeters >= 1.0 && heightMeters < 1.5) {
        score += 25;
      } else if (heightMeters > 3.0 && heightMeters <= 4.5) {
        score += 30;
      } else if (heightMeters > 4.5) {
        score += 15;
      }
      
      // Period (35% weight) - exponential weight for quality
      const period = wavePeriod || 0;
      if (period >= 14) {
        score += 35;
      } else if (period >= 12) {
        score += 30;
      } else if (period >= 10) {
        score += 20;
      } else if (period >= 8) {
        score += 10;
      }
      
      // Wind Alignment (25% weight) - light is best
      const wind = windSpeed || 0;
      const windKmh = wind * 3.6;
      if (windKmh < 10) {
        score += 25;
      } else if (windKmh < 20) {
        score += 15;
      } else if (windKmh < 30) {
        score += 5;
      }
      
      // Swell Run Bonus (+10 if consistent next 48h)
      if (next48h && next48h.length > 24) {
        const avgHeight = next48h.reduce((sum, h) => sum + h.waveHeight, 0) / next48h.length;
        const avgPeriod = next48h.reduce((sum, h) => sum + h.wavePeriod, 0) / next48h.length;
        
        if (avgHeight >= 1.2 && avgPeriod >= 10) {
          score += 10;
        }
      }
      
      return Math.min(100, Math.max(0, Math.round(score)));
    }
    
    // CALCULATE SKI STRIKE CONFIDENCE (Genesis Algorithm)
    function calculateSkiStrikeConfidence({ snow24h, temp, windSpeed }) {
      let score = 0;
      
      // 24h New Snow (50% weight)
      if (snow24h >= 10) {
        score += 50;
      } else if (snow24h >= 5) {
        score += 30;
      } else if (snow24h >= 2) {
        score += 15;
      }
      
      // Temperature (30% weight) - powder temp
      if (temp < -5) {
        score += 30;
      } else if (temp < -2) {
        score += 25;
      } else if (temp < 0) {
        score += 15;
      }
      
      // Wind Speed (20% weight)
      if (windSpeed < 15) {
        score += 20;
      } else if (windSpeed < 25) {
        score += 10;
      }
      
      return Math.min(100, Math.max(0, Math.round(score)));
    }
    
    // UPDATE SURF MARKER
    function updateSurfMarker(breakId, score, data) {
      const markerObj = surfMarkers.find(m => m.id === breakId);
      if (!markerObj) return;
      
      const color = score >= 80 ? '#22c55e' : score >= 60 ? '#eab308' : '#6366f1';
      const radius = score >= 80 ? 10 : 7;
      
      markerObj.marker.setStyle({
        fillColor: color,
        radius: radius
      });
      
      // Add pulse animation for high scores
      if (score >= 80) {
        markerObj.marker.getElement()?.classList.add('strike-marker');
      }
      
      // Update popup
      const popup = markerObj.marker.getPopup();
      if (popup) {
        const spot = markerObj.spot;
        popup.setContent(createUpdatedPopup(spot, breakId, 'surf', score, data));
      }
    }
    
    // UPDATE SKI MARKER
    function updateSkiMarker(resortId, score, data) {
      const markerObj = skiMarkers.find(m => m.id === resortId);
      if (!markerObj) return;
      
      // Update popup
      const popup = markerObj.marker.getPopup();
      if (popup) {
        const resort = markerObj.resort;
        popup.setContent(createUpdatedPopup(resort, resortId, 'ski', score, data));
      }
    }
    
    // CREATE UPDATED POPUP
    function createUpdatedPopup(spot, id, type, score, data) {
      const confidenceClass = score >= 80 ? 'confidence-strike' : score >= 60 ? 'confidence-good' : 'confidence-poor';
      const confidenceLabel = score >= 80 ? 'üéØ STRIKE' : score >= 60 ? 'GOOD' : 'POOR';
      
      let dataRows = '';
      
      if (type === 'surf') {
        const heightFt = (data.waveHeight * 3.28084).toFixed(1);
        const windMph = (data.windSpeed * 2.237).toFixed(0);
        dataRows = `
          <div class="data-row">
            <span class="data-label">Wave Height</span>
            <span class="data-value">${heightFt}ft</span>
          </div>
          <div class="data-row">
            <span class="data-label">Period</span>
            <span class="data-value">${data.wavePeriod}s</span>
          </div>
          <div class="data-row">
            <span class="data-label">Wind</span>
            <span class="data-value">${windMph}mph @ ${data.windDir}¬∞</span>
          </div>
        `;
      } else {
        const tempF = (data.temp * 9/5 + 32).toFixed(0);
        dataRows = `
          <div class="data-row">
            <span class="data-label">Temperature</span>
            <span class="data-value">${tempF}¬∞F</span>
          </div>
          <div class="data-row">
            <span class="data-label">24h Snow</span>
            <span class="data-value">${data.snow24h.toFixed(1)}cm</span>
          </div>
          <div class="data-row">
            <span class="data-label">Wind</span>
            <span class="data-value">${data.windSpeed.toFixed(0)}mph</span>
          </div>
        `;
      }
      
      const popupId = `popup-${id}`;
      return `
        <div id="${popupId}">
          <div class="popup-tabs">
            <div class="popup-tab active" onclick="switchTab('${popupId}', 'conditions')">Conditions</div>
            <div class="popup-tab" onclick="switchTab('${popupId}', 'intel')">Intel</div>
            <div class="popup-tab" onclick="switchTab('${popupId}', 'travel')">Travel</div>
          </div>
          <div class="popup-content">
            <div class="tab-content" data-tab="conditions">
              <div class="popup-header">
                <h3 class="popup-title">${spot.name}</h3>
                <span class="confidence-badge ${confidenceClass}">${score}/100 ${confidenceLabel}</span>
              </div>
              <div class="data-grid">
                ${dataRows}
              </div>
            </div>
            <div class="tab-content" data-tab="intel" style="display: none;">
              <div class="popup-header">
                <h3 class="popup-title">Spot Intelligence</h3>
              </div>
              <div class="video-container">
                <iframe width="100%" height="180" 
                  src="https://www.youtube.com/embed/${getYouTubeId(spot.name, type)}" 
                  frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                  allowfullscreen></iframe>
              </div>
              <div class="action-buttons">
                <a href="${getSurflineURL(spot.name)}" target="_blank" class="action-btn">
                  üìä ${type === 'surf' ? 'Surfline' : 'OnTheSnow'}
                </a>
                <a href="#" class="action-btn">
                  üìπ Live Cam
                </a>
              </div>
            </div>
            <div class="tab-content" data-tab="travel" style="display: none;">
              <div class="popup-header">
                <h3 class="popup-title">Travel Intel</h3>
              </div>
              <div class="data-grid">
                <div class="data-row">
                  <span class="data-label">Flights from SFO</span>
                  <span class="data-value">$${estimateFlightCost(spot.region)}</span>
                </div>
                <div class="data-row">
                  <span class="data-label">Visa Required</span>
                  <span class="data-value">${getVisaInfo(spot.region)}</span>
                </div>
              </div>
              <div class="action-buttons" style="grid-template-columns: 1fr;">
                <a href="https://www.google.com/flights?q=${encodeURIComponent(spot.name)}" target="_blank" class="action-btn action-btn-primary">
                  ‚úàÔ∏è Book Flights
                </a>
              </div>
            </div>
          </div>
        </div>
      `;
    }
    
    // HELPER FUNCTIONS
    function getYouTubeId(spotName, type) {
      // Create a search query for YouTube
      const query = type === 'surf' 
        ? `${spotName} surf report guide` 
        : `${spotName} ski powder report`;
      
      // YouTube search embeds don't work well, so we'll link to search
      // In production, use YouTube Data API to get actual video ID
      const searchQuery = encodeURIComponent(query);
      return `https://www.youtube.com/results?search_query=${searchQuery}`;
    }
    
    function getYouTubeEmbedHTML(spotName, type) {
      // For demo, embed a generic ski/surf video
      // In production, use YouTube Data API to search and get top result
      const videoIds = {
        'surf': 'dQw4w9WgXcQ', // Replace with actual surf videos
        'ski': 'dQw4w9WgXcQ'   // Replace with actual ski videos
      };
      
      const query = type === 'surf' 
        ? `${spotName} surf conditions` 
        : `${spotName} powder skiing`;
      
      return `
        <div class="video-container" style="position: relative;">
          <div style="position: absolute; top: 8px; right: 8px; z-index: 10;">
            <a href="${getYouTubeId(spotName, type)}" 
               target="_blank" 
               style="display: inline-block; padding: 6px 12px; background: rgba(0,0,0,0.7); border-radius: 6px; color: #fff; font-size: 11px; text-decoration: none; font-weight: 600;">
              üîç Search YouTube
            </a>
          </div>
          <div style="padding: 40px 20px; background: rgba(255,255,255,0.02); border-radius: 8px; text-align: center;">
            <div style="font-size: 32px; margin-bottom: 12px;">üìπ</div>
            <div style="font-size: 12px; color: rgba(255,255,255,0.6); margin-bottom: 8px;">Watch: "${query}"</div>
            <a href="${getYouTubeId(spotName, type)}" 
               target="_blank"
               class="action-btn action-btn-primary"
               style="display: inline-block; text-decoration: none; margin-top: 8px;">
              Open in YouTube
            </a>
          </div>
        </div>
      `;
    }
    
    function getSurflineURL(spotName) {
      const slug = spotName.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
      return `https://www.surfline.com/surf-reports/${slug}`;
    }
    
    function getOnTheSnowURL(spotName) {
      const slug = spotName.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
      return `https://www.onthesnow.com/ski-resort/${slug}`;
    }
    
    function getResortOfficialURL(resortId) {
      const resortURLs = {
        'whistler': 'https://www.whistlerblackcomb.com/the-mountain/mountain-conditions/terrain-and-lift-status.aspx',
        'baker': 'https://www.mtbaker.us/mountain-report/',
        'jackson': 'https://www.jacksonhole.com/lift-and-terrain-status',
        'alta': 'https://www.alta.com/conditions',
        'vail': 'https://www.vail.com/the-mountain/mountain-conditions/snow-and-weather-report.aspx',
        'mammoth': 'https://www.mammothmountain.com/conditions-weather',
        'stowe': 'https://www.stowe.com/the-mountain/mountain-conditions/',
        'killington': 'https://www.killington.com/the-mountain/mountain-conditions/mountain-report',
        'valle': 'https://www.vallenevado.com/en/mountain-info/',
        'portillo': 'https://www.skiportillo.com/en/mountain-info/'
      };
      
      return resortURLs[resortId] || '#';
    }
    
    function estimateFlightCost(region) {
      const prices = {
        'CA': 150, 'HI': 350, 'Mexico': 280, 'El Salvador': 320,
        'Nicaragua': 340, 'Costa Rica': 310, 'Panama': 330,
        'NY': 200, 'MA': 180, 'VT': 160, 'Chile': 650
      };
      return prices[region] || 400;
    }
    
    function getVisaInfo(region) {
      const noVisa = ['CA', 'HI', 'NY', 'MA', 'VT', 'WA', 'CO', 'UT'];
      return noVisa.includes(region) ? 'No' : 'Check';
    }
    
    // CHECK FOR FIRE ALERT (>85 score)
    function checkFireAlert() {
      const fireStrikes = Object.entries(strikeData)
        .filter(([id, data]) => data.score >= 85)
        .sort((a, b) => b[1].score - a[1].score);
      
      const alertDiv = document.getElementById('fire-alert');
      if (!alertDiv) return;
      
      if (fireStrikes.length > 0) {
        const topStrike = fireStrikes[0];
        const spot = topStrike[1].type === 'surf' 
          ? SURF_BREAKS[topStrike[0]] 
          : SKI_RESORTS.find(r => r.id === topStrike[0]);
        
        const typeLabel = topStrike[1].type === 'surf' ? 'Surfing' : 'Skiing';
        
        alertDiv.innerHTML = `
          <div style="display: flex; align-items: center; gap: 10px; padding: 12px 16px; background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); border-radius: 8px; cursor: pointer;"
               onclick="flyToStrike('${topStrike[0]}', ${spot.lat}, ${spot.lon})">
            <div style="font-size: 20px; animation: fireRotate 2s linear infinite;">üî•</div>
            <div style="flex: 1;">
              <div style="font-size: 11px; font-weight: 700; color: #22c55e; text-transform: uppercase; letter-spacing: 0.5px;">${typeLabel} is Firing</div>
              <div style="font-size: 10px; color: rgba(255,255,255,0.6);">${spot.name} ¬∑ ${topStrike[1].score}/100</div>
            </div>
            <div style="font-size: 10px; color: rgba(255,255,255,0.5);">‚Üí</div>
          </div>
        `;
        alertDiv.style.display = 'block';
      } else {
        alertDiv.style.display = 'none';
      }
    }
    
    // UPDATE STATS
    function updateStats() {
      const activeStrikes = Object.values(strikeData).filter(d => d.score >= 70).length;
      const missedCount = missedStrikes.length;
      
      document.getElementById('stat-active').textContent = activeStrikes;
      document.getElementById('stat-missed').textContent = missedCount;
      
      checkFireAlert();
    }
    
    // SET LIVE STATUS
    function setLiveStatus(isLive) {
      const indicator = document.getElementById('liveIndicator');
      if (isLive) {
        indicator.classList.remove('offline');
      } else {
        indicator.classList.add('offline');
      }
    }
    
    // FILTER MARKERS
    function filterMarkers(type) {
      currentView = type;
      
      surfMarkers.forEach(m => {
        if (type === 'all' || type === 'surf') {
          map.addLayer(m.marker);
        } else {
          map.removeLayer(m.marker);
        }
      });
      
      skiMarkers.forEach(m => {
        if (type === 'all' || type === 'ski') {
          map.addLayer(m.marker);
        } else {
          map.removeLayer(m.marker);
        }
      });
    }
    
    // EVENT LISTENERS
    document.getElementById('seg-all').addEventListener('click', function() {
      document.querySelectorAll('.segment-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      filterMarkers('all');
    });
    
    document.getElementById('seg-surf').addEventListener('click', function() {
      document.querySelectorAll('.segment-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      filterMarkers('surf');
    });
    
    document.getElementById('seg-ski').addEventListener('click', function() {
      document.querySelectorAll('.segment-btn').forEach(b => b.classList.remove('active'));
      this.classList.add('active');
      filterMarkers('ski');
    });
    
    document.getElementById('toggle-missed').addEventListener('click', function() {
      this.classList.toggle('active');
      showMissedStrikes = !showMissedStrikes;
      // TODO: Implement missed strikes visualization
    });
    
    document.getElementById('toggle-highconf').addEventListener('click', function() {
      this.classList.toggle('active');
      showHighConfOnly = !showHighConfOnly;
      // TODO: Filter markers by confidence
    });
    
    document.getElementById('toggle-board').addEventListener('click', function() {
      this.classList.toggle('active');
      showStrikeBoard = !showStrikeBoard;
      const board = document.getElementById('strike-board');
      if (showStrikeBoard) {
        board.classList.remove('hidden');
        updateStrikeBoard();
      } else {
        board.classList.add('hidden');
      }
    });
    
    // INIT
    window.addEventListener('load', () => {
      console.log('üöÄ Window loaded, initializing Genesis Strike...');
      setTimeout(initMap, 100);
    });
  </script>
</body>
</html>
